<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TheFairMap - Admin</title>
  <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.css">
  <link rel="stylesheet" href="style.css">
</head>
<body class="admin-page">
  <div class="admin-wrap">
    <h1>TheFairMap Admin</h1>
    <p class="subtitle">Manage locations and categories. <a href="/">Back to viewer</a></p>

    <section class="admin-section">
      <div class="stats-row">
        <div class="stat-pill"><strong id="stat-total">0</strong> locations</div>
        <div class="stat-pill"><strong id="stat-cats">0</strong> categories in use</div>
        <div class="toolbar" style="margin-left:auto; margin-top:0;">
          <button id="btn-export" class="btn btn-primary" type="button">Export JSON</button>
          <input id="json-file" type="file" accept="application/json,.json" hidden>
          <button id="btn-import-json" class="btn btn-secondary" type="button">Import JSON</button>
        </div>
      </div>
    </section>

    <section class="admin-section">
      <h2>Add / Edit Location</h2>
      <p class="subtitle" style="margin-top:6px;">Click the map to set latitude and longitude.</p>
      <div id="admin-map"></div>

      <form id="add-form" class="admin-form">
        <div class="admin-grid">
          <div>
            <label for="loc-name">Name *</label>
            <input id="loc-name" type="text" required>
          </div>
          <div>
            <label for="loc-id">ID (auto-generated if blank)</label>
            <input id="loc-id" type="text" placeholder="auto">
          </div>
          <div>
            <label for="loc-category">Category *</label>
            <select id="loc-category" required></select>
          </div>
          <div>
            <label for="loc-address">Address / Booth / Notes</label>
            <input id="loc-address" type="text" placeholder="Arbor 1, Booth 66">
          </div>
          <div>
            <label for="loc-lat">Latitude *</label>
            <input id="loc-lat" type="number" step="any" required>
          </div>
          <div>
            <label for="loc-lng">Longitude *</label>
            <input id="loc-lng" type="number" step="any" required>
          </div>
        </div>

        <label for="loc-desc" style="margin-top:10px;">Description (HTML supported)</label>
        <textarea id="loc-desc" placeholder="<p>Details, links, formatting...</p>"></textarea>

        <label style="display:flex; align-items:center; gap:8px; margin-top:10px;">
          <input id="loc-featured" type="checkbox"> Featured
        </label>

        <div class="toolbar">
          <button id="btn-submit" type="submit" class="btn btn-primary">Add Location</button>
          <button type="reset" class="btn btn-secondary">Clear</button>
        </div>
      </form>
    </section>

    <section class="admin-section">
      <h2>CSV Import</h2>
      <p class="subtitle" style="margin-top:6px;">Headers: name, categoryId/categoryName/category, address, lat, lng, description, featured</p>
      <textarea id="csv-textarea" class="csv-area" placeholder="name,categoryName,address,lat,lng,description\nMy Booth,Food,Arbor 1,32.5600,-95.8600,<p>Open 9-5</p>"></textarea>
      <input id="csv-file" type="file" accept=".csv,.txt" style="margin-top:8px;">
      <div class="toolbar">
        <button id="btn-csv-import" type="button" class="btn btn-primary">Import CSV</button>
      </div>
    </section>

    <section class="admin-section">
      <h2>Locations</h2>
      <div class="admin-table-wrap">
        <table class="admin-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Address</th>
              <th>Category</th>
              <th>Coordinates</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="location-tbody"></tbody>
        </table>
      </div>
    </section>
  </div>

  <script src="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.js"></script>
  <script src="admin.js"></script>
</body>
</html>
